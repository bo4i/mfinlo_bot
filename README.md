# mfinlo_bot

Телеграм-бот для приёма и маршрутизации заявок в ИТ и АХО для Министерства финансов Липецкой области. Бот построен на [aiogram 3](https://docs.aiogram.dev/) и использует SQLAlchemy для хранения пользователей, администраторов и заявок.

## Возможности
- Регистрация пользователей с указанием ФИО, телефона, организации и кабинета.
- Создание ИТ- и АХО-заявок с выбором срочности (сразу или к указанной дате).
- Уведомление соответствующих администраторов о новых заявках и сохранение ссылок на отправленные сообщения.
- Автоматическое заполнение списка администраторов при старте на основе настроек.

## Требования
- Python 3.11+
- Telegram Bot API токен

## Установка
1. Клонируйте репозиторий и перейдите в его папку:
   ```bash
   git clone <repo-url>
   cd mfinlo_bot
   ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Настройка
Создайте файл `.env` в корне проекта и укажите необходимые переменные:
```
BOT_TOKEN=<ваш_токен_бота>
DATABASE_URL=sqlite:///./bot.db  # опционально, значение по умолчанию
```

Дополнительно в `app/config.py` можно настроить:
- `IT_ADMIN_IDS` — список Telegram ID ИТ-администраторов.
- `AHO_ADMIN_IDS` — список Telegram ID АХО-администраторов.
- `PREDEFINED_ORGANIZATIONS` и `ORGANIZATIONS_NEEDING_OFFICE_NUMBER` — список доступных организаций и тех, где требуется номер кабинета.

При старте бота таблицы БД создаются автоматически. По умолчанию используется SQLite файл `bot.db` в корне проекта.

## Запуск
Запустите бота командой:
```bash
python main.py
```
После старта бот начнёт опрос Telegram. Для первого использования выполните в чате команду `/start` и пройдите регистрацию.

## Структура проекта
- `main.py` — точка входа, настройка диспетчера и запуск опроса.
- `app/config.py` — конфигурация токена, базы данных и списков администраторов/организаций.
- `app/db` — подключение к базе, модели SQLAlchemy и утилиты для сессий.
- `app/routers` — хендлеры aiogram для регистрации, заявок и административных действий.
- `app/services/startup.py` — инициализация администраторов при старте.
- `app/keyboards` и `app/states` — разметка клавиатур и определения состояний FSM.

## Полезные советы
- При изменении `DATABASE_URL` не забудьте перенести существующую базу или пересоздать таблицы.
- Для тестирования уведомлений добавьте свой Telegram ID в списки администраторов и перезапустите бота.
